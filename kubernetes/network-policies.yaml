apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: deny-all-ingress
  namespace: zero-trust
spec:
  podSelector: {}
  policyTypes:
    - Ingress
  ingress: []
---
# Allow API Gateway to receive traffic from external sources
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-api-gateway-ingress
  namespace: zero-trust
spec:
  podSelector:
    matchLabels:
      app: api-gateway
  policyTypes:
    - Ingress
  ingress:
    - {}  # Allow all ingress (handled by LoadBalancer)
---
# Allow API Gateway to communicate with auth-service
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-gateway-to-auth
  namespace: zero-trust
spec:
  podSelector:
    matchLabels:
      app: auth-service
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: api-gateway
      ports:
        - protocol: TCP
          port: 8081
---
# Allow auth-service to communicate with postgres
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-auth-to-postgres
  namespace: zero-trust
spec:
  podSelector:
    matchLabels:
      app: postgres
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: auth-service
      ports:
        - protocol: TCP
          port: 5432
---
# Deny all egress by default (optional - can be restrictive)
# Uncomment if you want strict egress control
# apiVersion: networking.k8s.io/v1
# kind: NetworkPolicy
# metadata:
#   name: deny-all-egress
#   namespace: zero-trust
# spec:
#   podSelector: {}
#   policyTypes:
#     - Egress
#   egress:
#     - {}  # Allow DNS and basic connectivity
#     - to:
#         - namespaceSelector:
#             matchLabels:
#               name: kube-system
#       ports:
#         - protocol: UDP
#           port: 53  # DNS

